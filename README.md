# Решение по тех заданию

Имеется 3 поставщика данных. Они предоставляют информацию об организации из
открытых источников. Нам нужно получить Наименование и КПП по имеющемуся ИНН.

# Установка

Нужно создать папку, например назвав test, и запустив терминал из папки выполнить команду
```php
git clone https://github.com/RubyKeeper/test_rest_api.git
```
псоле переходим выше папки и переименовываем папку test_rest_api в www. В этом же уровне распаковываем файл docker.zip который лежит внутри папки www

теперь снова внутри папки www запустить команду докера:
```php
docker-compose up --build -d
```

в браузере проект доступен по адресам localhost и test.local

## Файл index.php

это основной файл, который в браузере покажет какие ответы нам дали источники и какие источники попали в статистику

Перечислены источники.

```php
$namespace = [
    'Psr\Http\Client\Ramis',
    'Psr\Http\Client\Warms',
    'Psr\Http\Client\Dadata'
];
```
и ИНН которые хотим проверить:
```php
// сюда пишем ИНН которые хотим проверить
$inn_array = [
    '5003021311',
    '0105031623',
    '0274062111',
    '0323110787',
];
```


## Основной класс выполняющий всю работу Data.php

`src/Data.php`

Нам нужно вести статистику, какие из источников успешно и быстро возвращают ответ. Для этого выбрана БД Redis с типом данных сортируемые списки.
```php
private function getClients(array $namespace): array { }
```
Указанный класс выполняет ниже перечисленные задачи:
- получает все источники со статстики у которых больше 10 успешных вызовов
- сравнивает количество источников с количеством в БД (по условию ТЗ)
- если каждый источник уже вызывался по 10 раз, то отдает их отсортированных по количеству успешных вызовов
- иначе отдает список источников, предварительно рандомно перемешивая их, использовав функцию shuffle()


Хочется выделить следующий момент. По условию ТЗ какие то источники могут возвращать пустые значения или не возвращать вовсе или возвращать ответы очень долго. Эту функцию имитирует рандомно следующий кусок кода
```php
  // имитация отрицательного ответа или долгого ответа
  switch (rand(0,2)) {
      case 0:
          $response = $item->sendRequest($inn);
          break;
      case 1;
          $response = false;
          break;
      case 2;
          $response = $item->sendRequest($inn);
          sleep(1);
          break;
  }
```

## Источники

Реальный источник здесь только один

`Psr\Http\Client\Dadata`

остальные источники, только заглушки рандомно отдающие название организации и КПП
